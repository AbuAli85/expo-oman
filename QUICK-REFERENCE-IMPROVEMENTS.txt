================================================================================
QUICK REFERENCE: SCENARIO IMPROVEMENTS
================================================================================

KEY CHANGES AT A GLANCE
───────────────────────

1. VARIABLE SCOPE
   ❌ Before: "roundtrip" (could leak)
   ✅ After:  "execution" (clean state)

2. SEARCH LOGIC
   ❌ Before: No pre-router search
   ✅ After:  Search → Aggregate → Extract row number

3. ROUTER LOGIC
   ❌ Before: Split by attendance response
   ✅ After:  Split by row existence

4. UPDATE MODE
   ❌ Before: "search" mode (inefficient)
   ✅ After:  "rowNumber" mode (efficient)

5. FALLBACK ROUTE
   ❌ Before: Tried to update (would fail)
   ✅ After:  Adds new row

6. EMAIL AGGREGATION
   ❌ Before: No aggregation (could duplicate)
   ✅ After:  Array aggregator before email

MODULE ORDER
────────────

1. Google Forms → Watch Responses
2. Set Variables (email, name, attendance, comments)
3. Search Rows (by email)
4. Array Aggregator (search results)
5. Set Variables (rowNumber, rowExists)
6. Router
   ├─ Route 1: rowExists = "true"
   │  ├─ Update Row (rowNumber mode)
   │  ├─ Array Aggregator
   │  └─ Send Email
   └─ Route 2: Fallback
      ├─ Add Row
      ├─ Array Aggregator
      └─ Send Email

KEY VARIABLES
─────────────

{{2.email}}        - Form respondent email
{{2.name}}         - Form respondent name
{{2.attendance}}   - Attendance response
{{2.comments}}     - Additional comments
{{5.rowNumber}}    - Row number if exists
{{5.rowExists}}    - "true" or "false"

ROUTER FILTERS
──────────────

Route 1: Update Existing Row
  Condition: {{5.rowExists}} equals "true"

Route 2: Add New Row
  Condition: None (fallback)

TESTING CHECKLIST
─────────────────

☐ Test with new email (not in sheet)
  Expected: Route 2, Add Row, Email sent

☐ Test with existing email (in sheet)
  Expected: Route 1, Update Row, Email sent

☐ Verify only ONE email per submission

☐ Check Google Sheets data is correct

☐ Monitor execution logs for errors

COMMON ISSUES & FIXES
─────────────────────

Issue: "Row number is required"
Fix:   Check Module 5 sets rowNumber correctly

Issue: Multiple emails sent
Fix:   Ensure Array Aggregator before email

Issue: Variables not updating
Fix:   Check scope is "One execution"

Issue: Update fails
Fix:   Verify using "rowNumber" mode, not "search"

PERFORMANCE METRICS
───────────────────

Operations per execution: ~9 (down from ~11)
Execution time: ~3.5 seconds
Success rate: >95% expected
Email delivery: 100% expected

================================================================================
END OF QUICK REFERENCE
================================================================================



