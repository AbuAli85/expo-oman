================================================================================
FIX: Make.com Scenario Errors
================================================================================

ERROR 1: English Email Not Sending
-----------------------------------
"The bundle did not pass through the filter"

PROBLEM:
--------
Your router filter checks for Language = "en" (lowercase)
But your Google Sheets might have "EN" (uppercase)

SOLUTION:
---------
Check what value is actually in your Google Sheets Language column (D).

Option A: If sheets use "EN" and "AR" (uppercase):
- Route 1 filter: Language = "EN" (not "en")
- Route 2 filter: Language = "AR" (not "ar")

Option B: If sheets use "en" and "ar" (lowercase):
- Keep filters as "en" and "ar" ✅

Option C: Make filter case-insensitive:
- Use "text:equal" with proper case matching
- Or use "text:contains" if case varies


ERROR 2: Arabic Email - "to field must be a string"
---------------------------------------------------
[422] The `to` field must be a `string`.

PROBLEM:
--------
In Route 2, Module 4 (Arabic Email), the "to" field is receiving:
- An array: ["email@example.com"] ❌
- Or an object/undefined value ❌

But Resend expects:
- A string: "email@example.com" ✅

SOLUTION:
---------
In Module 4 (Arabic Email), check the "to" field mapping:

Current (WRONG):
"to": ["{{1.`1`}}"]  ← This creates an array

Should be:
"to": ["{{1.1}}"]  ← Make sure it's accessing the email correctly

OR if Resend expects a string directly:
"to": "{{1.1}}"  ← Single string (but Resend usually wants array)

Actually, Resend DOES expect an array, so the issue is likely:
- {{1.`1`}} is not resolving correctly
- The email value is empty or undefined
- The column reference is wrong

FIX:
----
1. Check that {{1.1}} (or {{1.`1`}}) actually contains an email address
2. Make sure the column mapping is correct:
   - Column B = Email
   - In Make.com, this is accessed as {{1.1}} (column index 1)
3. Verify the email field is not empty in your test row


================================================================================
DETAILED FIXES
================================================================================

FIX 1: Language Filter
-----------------------

In Module 2 (Router):

Route 1 (English):
- Current filter: Language (D) = "en"
- Check your Google Sheets - what's actually in column D?
- If it's "EN", change filter to: Language = "EN"
- If it's "en", keep as is

Route 2 (Arabic):
- Current filter: Language (D) = "ar"  
- Check your Google Sheets - what's actually in column D?
- If it's "AR", change filter to: Language = "AR"
- If it's "ar", keep as is

To check:
1. Look at your Google Sheets
2. See what values are in the Language column (D)
3. Match the filter exactly (case-sensitive!)


FIX 2: Email Address Mapping
-----------------------------

In Module 4 (Arabic Email - Route 2):

Check the "to" field:
- Should be: ["{{1.1}}"]
- Column 1 (B) = Email address
- Make sure {{1.1}} resolves to an actual email

Debug steps:
1. Add a Set Variable module before the email
2. Set variable: testEmail = {{1.1}}
3. Check what value it contains
4. If empty/undefined, the column mapping is wrong

Common issues:
- Column index might be 0-based or 1-based
- Try {{1.0}} instead of {{1.1}}
- Or check if headers are included in the count


================================================================================
QUICK DEBUGGING STEPS
================================================================================

STEP 1: Check Language Values
------------------------------
1. Open your Google Sheets
2. Look at column D (Language)
3. Note the exact values (EN/en, AR/ar)
4. Update router filters to match exactly

STEP 2: Check Email Column
---------------------------
1. In Module 1 output, check what {{1.1}} contains
2. If empty, try {{1.0}} or check column mapping
3. Verify the email column (B) has data

STEP 3: Test Email Mapping
---------------------------
1. Add a Set Variable module after Module 1
2. Variable name: testEmail
3. Value: {{1.1}}
4. Run scenario and check what value is stored
5. This will tell you if the mapping is correct

STEP 4: Fix Email Module
-------------------------
Once you know the correct mapping:
1. In Module 4 (Arabic Email)
2. Set "to" field to: ["{{correctMapping}}"]
3. Make sure it's an array with one email string inside


================================================================================
COMMON MAPPING ISSUES
================================================================================

If headers are included:
- Column A (Name) = {{1.0}}
- Column B (Email) = {{1.1}} ✅
- Column C (Phone) = {{1.2}}
- Column D (Language) = {{1.3}}

If headers are NOT included (0-based):
- Column A (Name) = {{1.0}}
- Column B (Email) = {{1.1}} ✅
- Column C (Phone) = {{1.2}}
- Column D (Language) = {{1.3}}

The issue might be:
- Using {{1.`1`}} with backticks (might not work)
- Should use {{1.1}} without backticks
- Or the column index is wrong


================================================================================
RECOMMENDED FIXES
================================================================================

1. VERIFY LANGUAGE VALUES:
   - Check Google Sheets column D
   - Update router filters to match exactly (case-sensitive)

2. FIX EMAIL MAPPING:
   - In Module 4, change "to" to: ["{{1.1}}"]
   - Remove any backticks
   - Make sure it's accessing column B (Email)

3. TEST:
   - Add a test row with known values
   - Language = "EN" or "AR" (match your filter)
   - Email = a valid email address
   - Run scenario and check errors

================================================================================

